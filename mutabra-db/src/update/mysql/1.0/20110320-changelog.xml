<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
		xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">

	<changeSet id="00" author="ikhalopik@gmail.com" context="schema">
		<addColumn tableName="CARD">
			<column name="ID_EFFECT" type="INTEGER">
				<constraints nullable="true"/>
			</column>
		</addColumn>
		<addColumn tableName="CARD">
			<column name="ID_SUMMON" type="INTEGER">
				<constraints nullable="true"/>
			</column>
		</addColumn>

		<addForeignKeyConstraint constraintName="FK_CARD_EFFECT"
								 baseTableName="CARD" baseColumnNames="ID_EFFECT"
								 referencedTableName="EFFECT" referencedColumnNames="ID"/>

		<addForeignKeyConstraint constraintName="FK_CARD_SUMMON"
								 baseTableName="CARD" baseColumnNames="ID_SUMMON"
								 referencedTableName="SUMMON" referencedColumnNames="ID"/>

		<rollback>
			<dropForeignKeyConstraint baseTableName="CARD" constraintName="FK_CARD_SUMMON"/>
			<dropForeignKeyConstraint baseTableName="CARD" constraintName="FK_CARD_EFFECT"/>
		</rollback>
	</changeSet>

	<changeSet id="01" author="ikhalopik@gmail.com" context="init">
		<sql>
			UPDATE CARD SET ID_EFFECT = (SELECT ID_EFFECT FROM EFFECT_CARD WHERE EFFECT_CARD.ID = CARD.ID);
		</sql>
	</changeSet>

	<changeSet id="02" author="ikhalopik@gmail.com" context="init">
		<sql>
			UPDATE CARD SET ID_SUMMON = (SELECT ID_SUMMON FROM SUMMON_CARD WHERE SUMMON_CARD.ID = CARD.ID);
		</sql>
	</changeSet>

	<changeSet id="03" author="ikhalopik@gmail.com" context="schema">
		<dropForeignKeyConstraint baseTableName="EFFECT_CARD" constraintName="FK_ECARD_CARD"/>
		<dropForeignKeyConstraint baseTableName="EFFECT_CARD" constraintName="FK_ECARD_EFFECT"/>
		<dropTable tableName="EFFECT_CARD"/>

		<rollback>
			<createTable tableName="EFFECT_CARD">
				<column name="ID" type="INTEGER">
					<constraints nullable="false" primaryKey="true"/>
				</column>
				<column name="ID_EFFECT" type="INTEGER">
					<constraints nullable="false"/>
				</column>
			</createTable>

			<addForeignKeyConstraint constraintName="FK_ECARD_CARD"
									 baseTableName="EFFECT_CARD" baseColumnNames="ID"
									 referencedTableName="CARD" referencedColumnNames="ID"/>

			<addForeignKeyConstraint constraintName="FK_ECARD_EFFECT"
									 baseTableName="EFFECT_CARD" baseColumnNames="ID_EFFECT"
									 referencedTableName="EFFECT" referencedColumnNames="ID"/>
		</rollback>
	</changeSet>

	<changeSet id="04" author="ikhalopik@gmail.com" context="schema">
		<dropForeignKeyConstraint baseTableName="SUMMON_CARD" constraintName="FK_SCARD_CARD"/>
		<dropForeignKeyConstraint baseTableName="SUMMON_CARD" constraintName="FK_SCARD_SUMMON"/>
		<dropTable tableName="SUMMON_CARD"/>

		<rollback>
			<createTable tableName="SUMMON_CARD">
				<column name="ID" type="INTEGER">
					<constraints nullable="false" primaryKey="true"/>
				</column>
				<column name="ID_SUMMON" type="INTEGER">
					<constraints nullable="false"/>
				</column>
			</createTable>

			<addForeignKeyConstraint constraintName="FK_SCARD_CARD"
									 baseTableName="SUMMON_CARD" baseColumnNames="ID"
									 referencedTableName="CARD" referencedColumnNames="ID"/>

			<addForeignKeyConstraint constraintName="FK_SCARD_SUMMON"
									 baseTableName="SUMMON_CARD" baseColumnNames="ID_SUMMON"
									 referencedTableName="SUMMON" referencedColumnNames="ID"/>
		</rollback>
	</changeSet>
</databaseChangeLog>